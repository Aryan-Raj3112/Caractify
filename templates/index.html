{% extends "layout.html" %}

{% block content %}
<body>
    <header class="header">
        <img src="{{ url_for('static', filename='gemini.webp') }}" alt="Logo">
        <h2>Orion</h2>
    </header>

    <div class="chat-box">
        {% if chat_history %}
            {% for message in chat_history %}
                <div class="message {{ message['role'] }}-msg">
                    {% if message['role'] == 'model' %}
                        {{ message['parts'] | markdown | safe }}
                    {% else %}
                        {{ message['parts'] | safe }}
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <footer class="footer">
        <form action="/chat" method="POST" id="chatForm">
            <input type="hidden" name="session_id" value="{{ session_id }}">
            <textarea autocomplete="off" autofocus name="message" 
                      placeholder="Enter your message" required id="messageInput"></textarea>
        </form>
    </footer>
    <script>
        const messageInput = document.getElementById('messageInput');
        const chatForm = document.getElementById('chatForm');

        // Auto-grow and shrink textarea
        messageInput.addEventListener('input', function() {
            // Reset height to auto to get proper scrollHeight
            this.style.height = 'auto';
            // Set new height based on content
            const newHeight = Math.max(30, Math.min(this.scrollHeight, 160));
            this.style.height = newHeight + 'px';
        });
        
        // Handle Enter and Shift+Enter
        messageInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                // Regular Enter - submit form
                event.preventDefault();
                chatForm.submit();
                messageInput.value = '';
            } else if (event.key === 'Enter' && event.shiftKey) {
                return true;
            }
        });
    </script>
</body>
{% endblock %}